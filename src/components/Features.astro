---
interface Feature {
  title: string;
  description: string;
  media?: {
    type: 'image' | 'video';
    src: string;
    alt?: string;
  };
}

const features: Feature[] = [
  {
    title: 'Smart Triggers',
    description:
      'Set a primary condition — cross, touch, or break of a level or indicator — then layer validation filters using natural syntax. Group triggers into setups, assign priority, and define one-cancels-other conditions.',
  },
  {
    title: 'Execution Presets',
    description:
      'Auto limit orders with configurable slippage tolerance, expiration, time-of-day windows and auto-convert to market if not filled after a certain time.',
  },
  {
    title: 'Position Sizing',
    description:
      'Scale into positions using pyramid or volatility-targeting presets. Specify your desired allocation: start, mid, full, or overweight. Glasshouse calculates optimal size based on current price, volatility, and available capital.',
  },
  {
    title: 'Max Stops',
    description:
      'Cap your downside with hidden max stops — held locally, never placed at the broker — that attach automatically to new positions.',
  },
  {
    title: 'Hard Risk Limits',
    description:
      'Set exposure limits — both cumulative and single-position — along with per session velocity controls: max spend, max number of buys, and repeat buy limits per instrument. These limits cannot be modified during live trading, preventing emotional overrides and rogue AI behaviour. All orders are routed to a risk check before execution, and rejected if they breach any limits.',
  },
  {
    title: 'Trading Agents Dashboard',
    description:
      'Run a trading desk of autonomous agents. Code their workflow natively in Python: when to scan, when to enter, how to size, when to exit. Register each agent on the platform with its own capital allocation and risk rules. Monitor and intervene at any point: pause, stop, or kill and flatten all positions.',
  },
];
---

<section id="features" class="px-6 py-24">
  <div class="mx-auto max-w-6xl">
    <h2 class="text-center text-3xl font-bold tracking-tight text-text-primary sm:text-4xl">
      Key features at a glance
    </h2>

    <div class="mt-12 grid gap-0 overflow-hidden rounded-xl border border-border md:grid-cols-[2fr_3fr]">
      <!-- Left: tab list -->
      <div class="border-r border-border bg-bg-elevated">
        {features.map((feature, i) => (
          <button
            data-tab={i}
            class:list={[
              'feature-tab block w-full border-b border-border px-8 py-6 text-left transition-colors',
              i === 0 ? 'bg-bg-card' : 'hover:bg-bg-card/50',
            ]}
          >
            <h3 class:list={[
              'text-lg font-semibold transition-colors',
              i === 0 ? 'text-accent' : 'text-text-muted',
            ]}>
              {feature.title}
            </h3>
            <p class:list={[
              'mt-2 text-sm leading-relaxed transition-opacity',
              i === 0 ? 'text-text-secondary opacity-100' : 'text-text-muted opacity-0 h-0 overflow-hidden',
            ]}>
              {feature.description}
            </p>
          </button>
        ))}
      </div>

      <!-- Right: media panel -->
      <div class="relative bg-bg-card p-6 flex items-center justify-center min-h-[400px]">
        {features.map((feature, i) => (
          <div
            data-panel={i}
            class:list={[
              'feature-panel absolute inset-6 flex items-center justify-center transition-opacity duration-300',
              i === 0 ? 'opacity-100' : 'opacity-0 pointer-events-none',
            ]}
          >
            {feature.media ? (
              feature.media.type === 'image' ? (
                <img
                  src={feature.media.src}
                  alt={feature.media.alt || feature.title}
                  class="max-h-full max-w-full rounded-lg object-contain"
                  loading="lazy"
                />
              ) : (
                <video
                  src={feature.media.src}
                  autoplay
                  muted
                  loop
                  playsinline
                  class="max-h-full max-w-full rounded-lg object-contain"
                />
              )
            ) : (
              <div class="flex flex-col items-center gap-3 text-text-muted">
                <svg class="h-16 w-16 opacity-30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span class="text-sm">Screenshot or recording</span>
              </div>
            )}
          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<script>
  const tabs = document.querySelectorAll('.feature-tab');
  const panels = document.querySelectorAll('.feature-panel');

  tabs.forEach((tab) => {
    tab.addEventListener('click', () => {
      const index = tab.getAttribute('data-tab');

      tabs.forEach((t) => {
        const isActive = t.getAttribute('data-tab') === index;
        t.classList.toggle('bg-bg-card', isActive);
        t.classList.toggle('hover:bg-bg-card/50', !isActive);
        const heading = t.querySelector('h3');
        const desc = t.querySelector('p');
        if (heading) {
          heading.classList.toggle('text-accent', isActive);
          heading.classList.toggle('text-text-muted', !isActive);
        }
        if (desc) {
          desc.classList.toggle('text-text-secondary', isActive);
          desc.classList.toggle('text-text-muted', !isActive);
          desc.classList.toggle('opacity-100', isActive);
          desc.classList.toggle('opacity-0', !isActive);
          desc.classList.toggle('h-0', !isActive);
          desc.classList.toggle('overflow-hidden', !isActive);
        }
      });

      panels.forEach((p) => {
        const isActive = p.getAttribute('data-panel') === index;
        p.classList.toggle('opacity-100', isActive);
        p.classList.toggle('opacity-0', !isActive);
        p.classList.toggle('pointer-events-none', !isActive);
      });
    });
  });
</script>
